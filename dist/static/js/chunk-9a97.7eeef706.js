(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-9a97"],{"3o4L":function(e,t,i){"use strict";var a=i("N2YP");i.n(a).a},N2YP:function(e,t,i){},Wret:function(e,t,i){var a=i("g24s"),n=a.JSON||(a.JSON={stringify:JSON.stringify});e.exports=function(e){return n.stringify.apply(n,arguments)}},XPP3:function(e,t,i){"use strict";i.r(t);var a=i("rerW"),n=i.n(a),s=i("omC7"),r=i.n(s),o=i("EPZ6"),l=i.n(o),c=i("cLjf"),d=i.n(c),u=i("hDQ3"),p=i.n(u),m=i("+vOl"),f=(i("hrJr"),{data:function(){return{dialogVisible:!1,dialogImageUrl:"",activityInfo:{imgUrl_1:"",imgUrl_2:""},domain:"http://upload.qiniup.com/",iconFilelist:[],is_progress:!1,jindu:0,img_num:0,img_nums:0,qiniuAddress:"http://cdnimg.bxunion.com"}},methods:{_fetchQiNiuToken:function(){var e=this;return p()(d.a.mark(function t(){var i,a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.a)();case 2:return i=e.sent,a=i.data,e.abrupt("return",a);case 5:case"end":return e.stop()}},t,e)}))()},handleUpLoadIconImg:function(e){this._uploadQiNiu(e)},handleIconCardPreview:function(){this.dialogImageUrl=this.activityInfo.imgUrl_1,this.dialogVisible=!0},handleIconCardicon:function(){this.activityInfo.imgUrl_1="src/assets/404_images/bg_img.jpg",this.dialogImageUrl=this.activityInfo.imgUrl_1},_uploadQiNiu:function(e,t){var i=this;return p()(d.a.mark(function a(){var n,s,r,o,l,c;return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return n={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){i.jindu=e.loaded/e.total*100|0}},s=e.file.type.split("/")[1],r="top-team"+Date.now()+Math.floor(100*Math.random())+"."+s,a.next=5,i._fetchQiNiuToken();case 5:o=a.sent,(l=new FormData).append("token",o),l.append("key",r),c=i,e.file.size/1024>1025?-1==e.file.type.indexOf("image/")?(l.append("file",e.file),axios.post(i.domain,l,n).then(function(e){var a=i.qiniuAddress+"/"+e.data.key;"one"===t&&(i.activityInfo.imgUrl_1=a),i.is_progress=!1,i.jindu=0})):i.photoCompress(e.file,{quality:.2},function(i){var a=c.convertBase64UrlToBlob(i);a.uid=e.file.uid,a.name=e.file.name,a.uid=e.file.uid,a.lastModified=e.file.lastModified,a.lastModifiedDate=e.file.lastModifiedDate,a.webkitRelativePath=e.file.webkitRelativePath,l.append("file",a),axios.post("http://upload.qiniup.com/",l,n).then(function(e){var i=c.qiniuAddress+"/"+e.data.key;"one"===t&&(c.activityInfo.imgUrl_1=i),c.is_progress=!1,c.jindu=0})}):(l.append("file",e.file),axios.post(i.domain,l,n).then(function(e){var a=i.qiniuAddress+"/"+e.data.key;"one"===t&&(i.activityInfo.imgUrl_1=a),i.is_progress=!1,i.jindu=0}));case 11:case"end":return a.stop()}},a,i)}))()},handleImgChange:function(e){var t=this;return p()(d.a.mark(function i(){var a,s,o,c,u,p,m,f,g,v,h;return d.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:a={},s=document.querySelector("#ImgInput"),o=s.files.length,t.img_nums=o,c={headers:{"Content-Type":"multipart/form-data"}},0,u=d.a.mark(function i(n){var s,u,p,m,f;return d.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t.img_num=t.img_num+1,t.jindu=Math.floor(t.img_num/o*100),t.img_num==t.img_nums&&(t.is_progress=!1,t.jindu=0,t.img_num=0),s=n.type.split("/")[1],u="top-team"+Date.now()+100*Math.random()+"."+s,i.next=7,t._fetchQiNiuToken();case 7:if(p=i.sent,(m=new FormData).append("token",p),m.append("key",u),f=t,!(/image\/\w+/.test(n.type)&&n.size>1024e3)){i.next=16;break}t.photoCompress(n,{quality:.2},function(t){var i=f.convertBase64UrlToBlob(t);i.uid=n.uid,i.name=n.name,i.uid=n.uid,i.lastModified=n.lastModified,i.lastModifiedDate=n.lastModifiedDate,i.webkitRelativePath=n.webkitRelativePath,m.append("file",i),axios.post("http://upload.qiniup.com/",m,c).then(function(t){var i=f.qiniuAddress+"/"+t.data.key,s=n.name.split(".")[0];a[s]=i,console.log(l()(a).length),l()(a).length===o&&axios.post("/i/topteam/admin/MatchTaskPic",{match_list:r()(a)}).then(function(t){t.data.error_code?f.$message({message:t.data.error_msg,type:"error"}):(f.$message({message:"上传成功",type:"success"}),f._fetchTaskList(f.activityId)),e.target.value=""})})}),i.next=27;break;case 16:return m.append("file",n),i.prev=17,i.next=20,axios.post("http://upload.qiniup.com/",m,c).then(function(i){var s=t.qiniuAddress+"/"+i.data.key,c=n.name.split(".")[0];a[c]=s,console.log(l()(a).length),l()(a).length===o&&axios.post("/i/topteam/admin/MatchTaskPic",{activity_id:t.activityId,match_list:r()(a)}).then(function(i){i.data.error_code?t.$message({message:i.data.error_msg,type:"error"}):(t.$message({message:"上传成功",type:"success"}),t._fetchTaskList(t.activityId)),e.target.value=""})});case 20:i.next=27;break;case 22:i.prev=22,i.t0=i.catch(17),console.log(i.t0),e.target.value="",t.$message({message:"有图片上传失败，请重新上传全部图片",type:"error"});case 27:case"end":return i.stop()}},i,t,[[17,22]])}),p=!0,m=!1,f=void 0,i.prev=10,g=n()(s.files);case 12:if(p=(v=g.next()).done){i.next=18;break}return h=v.value,i.delegateYield(u(h),"t0",15);case 15:p=!0,i.next=12;break;case 18:i.next=24;break;case 20:i.prev=20,i.t1=i.catch(10),m=!0,f=i.t1;case 24:i.prev=24,i.prev=25,!p&&g.return&&g.return();case 27:if(i.prev=27,!m){i.next=30;break}throw f;case 30:return i.finish(27);case 31:return i.finish(24);case 32:case"end":return i.stop()}},i,t,[[10,20,24,32],[25,,27,31]])}))()},handleFileChange:function(e){var t=this,i=document.querySelector("#fileInput"),a=new FormData,n={headers:{"Content-Type":"multipart/form-data"},onUploadProgress:function(e){t.jindu=e.loaded/e.total*100|0}};a.append("file",i.files[0]),axios.post("/i/aaa/admin/importTask",a,n).then(function(i){var a=i.data;0!==a.error_code?(t.$message({message:a.error_msg,type:"error"}),e.target.value=""):(t.$message({message:"导入成功",type:"success"}),e.target.value=""),t.is_progress=!1,t.jindu=0})}}}),g=(i("3o4L"),i("ZrdR")),v=Object(g.a)(f,function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{padding:"10px"}},[i("el-tag",[e._v("单个图片上传")]),e._v(" "),i("div",{staticClass:"bar"}),e._v(" "),i("el-form",{attrs:{inline:!0,model:e.activityInfo}},[i("el-upload",{attrs:{"http-request":e.handleUpLoadIconImg,"on-preview":e.handleIconCardPreview,"on-remove":e.handleIconCardicon,limit:1,action:e.domain,"file-list":e.iconFilelist,"list-type":"picture-card"}},[i("el-button",[e._v("上传图片")])],1),e._v(" "),i("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("img",{attrs:{src:e.dialogImageUrl,width:"100%",alt:""}})])],1),e._v(" "),i("div",{staticClass:"bar"}),e._v(" "),i("el-tag",[e._v("多张图片上传")]),e._v(" "),i("div",{staticClass:"bar"}),e._v(" "),i("div",{staticClass:"filePicker"},[i("div",{staticClass:"filePicker_div"},[e._v("上传多张图片")]),e._v(" "),i("input",{staticClass:"filePicker_inp",attrs:{id:"ImgInput",type:"file",name:"file",multiple:"",accept:"image/*,vedio/*,audio/*"},on:{change:e.handleImgChange}})]),e._v(" "),i("div",{staticClass:"bar"}),e._v(" "),i("el-tag",[e._v("文件上传")]),e._v(" "),i("div",{staticClass:"bar"}),e._v(" "),i("div",{staticClass:"filePicker"},[i("div",{staticClass:"filePicker_div"},[e._v("上传excle文件")]),e._v(" "),i("input",{staticClass:"filePicker_inp",attrs:{id:"fileInput",type:"file",name:"file",multiple:"",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"},on:{change:e.handleFileChange}})]),e._v(" "),e.is_progress?i("div",{staticClass:"progress_wrap",attrs:{id:"progress"}},[i("div",{staticClass:"progress_wraps"},[i("div",{staticClass:"progress_bg"}),e._v(" "),i("div",{staticClass:"progress_content"},[i("el-progress",{attrs:{percentage:e.jindu,type:"circle"}}),e._v(" "),i("div",{staticStyle:{"text-align":"center"}},[e._v(e._s(e.img_num)+" / "+e._s(e.img_nums))])],1)])]):e._e()],1)},[],!1,null,null,null);v.options.__file="upload.vue";t.default=v.exports},omC7:function(e,t,i){e.exports={default:i("Wret"),__esModule:!0}}}]);